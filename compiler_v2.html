<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DFA Simulator</title>
  <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="style.css" />


</head>
<body data-theme="light">
  <aside>
    <div class="header">
      <div class="logo-container">
        <div class="logo">
          <i class="fas fa-project-diagram"></i>
        </div>
        <h1>DFA Simulator</h1>
      </div>
      <button class="toggle-mode" id="mode-toggle">
        <i class="fas fa-moon"></i>
      </button>
    </div>

    <div class="control-group">
      <label for="regex-select">Language Type</label>
      <select id="regex-select">
        <option value="binary">Binary Pattern</option>
        <option value="alphabet">Alphabet Pattern</option>
      </select>
    </div>

    <div class="control-group">
      <label for="input-string">Input String</label>
      <input type="text" id="input-string" placeholder="Enter a string to test..." />
    </div>

    <div class="input-animation" id="input-animation"></div>

    <button id="simulate-btn">
      <i class="fas fa-play"></i> Simulate DFA
    </button>
    
    <div id="result" class="result-empty">Waiting for simulation...</div>
  </aside>

  <main>
    <div class="card">
      <h2><i class="fas fa-code"></i> Regular Expression</h2>
      <div id="regex-display"></div>
    </div>

    <div class="card">
      <h2><i class="fas fa-project-diagram"></i> DFA Visualization</h2>
      <div id="cy"></div>
    </div>

    <div class="grid">
      <div class="card">
        <h2><i class="fas fa-server"></i> PDA Description</h2>
        <div class="placeholder" id="pda-placeholder">PDA description will appear here.</div>
      </div>

      <div class="card">
        <h2><i class="fas fa-sitemap"></i> Context-Free Grammar</h2>
        <div id="cfg-placeholder"></div>
      </div>
    </div>
  </main>


  <!-- LOGIC SIDE -->

  <script>

    const regexMap = {
      binary: `(111+000+101+001)(1+0)*(11+00)(11+00)*(101+111+000)(101+111+000)*(11+00)(1+0+11)(11)(00)(1+0+1+0)(1+0)`,
      alphabet: `(ab+ba)(ab+ba)*(aaa+bbb+aba)(a+b)*(bb)(aa)(a+b)(aa+bb)(a+b)*(bb+aa+aba+bab)(bb+aa+aba+bab)*`
    };

    const cfgMap = {
      binary: 'CFG will be provided by backend.',
      alphabet: `S → A B C D E F G H I J K

A → ab | ba
B → A B | △            \t(ab+ba)*

C → aaa | bbb | aba   \t (aaa+bbb+aba)

D → a D | b D | △     \t(a+b)*

E → bb               \t(bb)
F → aa               \t(aa)

G → a | b            \t(a+b)

H → aa | bb          \t(aa+bb)

I → a I | b I | △    \t(a+b)*

J → bb | aa | aba | bab   (bb+aa+aba+bab)
K → J K | △          \t(bb+aa+aba+bab)*`
    };

    const transitions = {
      'q0':  {'0': 'q2',   '1': 'q1'},
      'q1':  {'0': 'q3',   '1': 'q3'},
      'q2':  {'0': 'q4',   '1': 'T'},
      'q3':  {'0': 'T',    '1': 'q5'},
      'q4':  {'0': 'q5',   '1': 'q5'},
      'q5':  {'0': 'q7',   '1': 'q6'},
      'q6':  {'0': 'q7',   '1': 'q8'},
      'q7':  {'0': 'q8',   '1': 'q6'},
      'q8':  {'0': 'q10',  '1': 'q9'},
      'q9':  {'0': 'q11',  '1': 'q12'},
      'q10': {'0': 'q13',  '1': 'q8'},
      'q11': {'0': 'T',    '1': 'q14'},
      'q12': {'0': 'q9',   '1': 'q14'},
      'q13': {'0': 'q14',  '1': 'T'},
      'q14': {'0': 'q16',  '1': 'q15'},
      'q15': {'0': 'q16',  '1': 'q17'},
      'q16': {'0': 'q17',  '1': 'q15'},
      'q17': {'0': 'q19',  '1': 'q18'},
      'q18': {'0': 'q15',  '1': 'q20'},
      'q19': {'0': 'q20',  '1': 'q17'},
      'q20': {'0': 'q21',  '1': 'q20'},
      'q21': {'0': 'q21',  '1': 'q21'},
      'T':   {'0': 'T',    '1': 'T'}  // trap state
    };
    
    const acceptingStates = ['q0'];
    const finalstate = ['q21'];

    const regexDisplay = document.getElementById('regex-display');
    const cfgDisplay = document.getElementById('cfg-placeholder');
    const select = document.getElementById('regex-select');
    const inputField = document.getElementById('input-string');
    const resultDisplay = document.getElementById('result');
    const simulateBtn = document.getElementById('simulate-btn');
    const inputAnimation = document.getElementById('input-animation');

    function updateDisplay() {
      const selected = select.value;
      regexDisplay.textContent = regexMap[selected];
      cfgDisplay.textContent = cfgMap[selected];
      resultDisplay.textContent = 'Waiting for simulation...';
      resultDisplay.className = 'result-empty';
      inputAnimation.innerHTML = '';
    }

    select.addEventListener('change', updateDisplay);
    updateDisplay();

    // Initialize cytoscape with modern styling
    const cy = cytoscape({
      container: document.getElementById('cy'),
      elements: [
        { data: { id: 'q0', label: 'q0' } },
        { data: { id: 'q1', label: 'q1' } },
        { data: { id: 'q2', label: 'q2' } },
        { data: { id: 'q0q1a', source: 'q0', target: 'q1', label: 'a' } },
        { data: { id: 'q1q2b', source: 'q1', target: 'q2', label: 'b' } },
        { data: { id: 'q2q0a', source: 'q2', target: 'q0', label: 'a' } }
      ],
      style: [
        {
          selector: 'node',
          style: {
            'label': 'data(label)',
            'background-color': '#4299e1',
            'color': '#fff',
            'text-valign': 'center',
            'text-halign': 'center',
            'width': '50px',
            'height': '50px',
            'font-size': '14px',
            'font-weight': 'bold',
            'text-outline-color': '#4299e1',
            'text-outline-width': '1px'
          }
        },
        {
          selector: 'node[?accepting]',
          style: {
            'border-width': '3px',
            'border-color': '#48bb78',
            'border-style': 'double'
          }
        },
        {
          selector: 'edge',
          style: {
            'label': 'data(label)',
            'curve-style': 'bezier',
            'target-arrow-shape': 'triangle',
            'line-color': '#a0aec0',
            'target-arrow-color': '#a0aec0',
            'width': 2,
            'text-rotation': 'autorotate',
            'font-size': 14,
            'color': '#4a5568',
            'text-background-color': '#ffffff',
            'text-background-opacity': 0.7,
            'text-background-padding': '2px',
            'text-background-shape': 'roundrectangle'
          }
        },
        {
          selector: '.highlighted-node',
          style: {
            'background-color': '#ed64a6',
            'text-outline-color': '#ed64a6',
            'transition-property': 'background-color, text-outline-color',
            'transition-duration': '0.3s'
          }
        },
        {
          selector: '.highlighted-edge',
          style: {
            'line-color': '#ed64a6',
            'target-arrow-color': '#ed64a6',
            'color': '#ed64a6',
            'width': 3,
            'transition-property': 'line-color, target-arrow-color, color, width',
            'transition-duration': '0.3s'
          }
        }
      ],
      layout: {
        name: 'circle',
        padding: 50
      }
    });

    // Mark accepting states
    acceptingStates.forEach(state => {
      cy.$(`#${state}`).data('accepting', true);
    });

    async function animateString(input) {
      let current = 'q0';
      let valid = true;
      
      // Reset styles
      cy.nodes().removeClass('highlighted-node');
      cy.edges().removeClass('highlighted-edge');
      
      // Create animation boxes with proper initialization
      inputAnimation.innerHTML = '';
      
      // Always show initial state box
      const initialStateBox = document.createElement('div');
      initialStateBox.className = 'char-box current';
      initialStateBox.textContent = 'q0';
      initialStateBox.style.backgroundColor = '#4299e1';
      initialStateBox.style.color = 'white';
      inputAnimation.appendChild(initialStateBox);
      
      // Add arrow after initial state
      if (input.length > 0) {
        const arrow = document.createElement('div');
        arrow.style.display = 'flex';
        arrow.style.alignItems = 'center';
        arrow.textContent = '→';
        arrow.style.color = 'var(--text-secondary)';
        arrow.style.fontSize = '1.25rem';
        arrow.style.margin = '0 0.25rem';
        inputAnimation.appendChild(arrow);
      }
      
      // Add character boxes
      for (let i = 0; i < input.length; i++) {
        const charBox = document.createElement('div');
        charBox.className = 'char-box';
        charBox.id = `char-${i}`;
        charBox.textContent = input[i];
        inputAnimation.appendChild(charBox);
        
        // Add arrows between character boxes
        if (i < input.length - 1) {
          const arrow = document.createElement('div');
          arrow.style.display = 'flex';
          arrow.style.alignItems = 'center';
          arrow.textContent = '→';
          arrow.style.color = 'var(--text-secondary)';
          arrow.style.fontSize = '1.25rem';
          arrow.style.margin = '0 0.25rem';
          inputAnimation.appendChild(arrow);
        }
      }
      
      // Start with initial state highlighted
      cy.$(`#${current}`).addClass('highlighted-node');
      
      // Process each character
      for (let i = 0; i < input.length; i++) {
        const ch = input[i];
        
        // Highlight current character
        const charBox = document.getElementById(`char-${i}`);
        if (charBox) {
          charBox.classList.add('current');
          
          // Auto-scroll to keep the current character in view
          charBox.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        }
        
        await new Promise(r => setTimeout(r, 800));
        
        const next = transitions[current]?.[ch];
        if (!next) {
          valid = false;
          
          // Show error state for invalid transition
          if (charBox) {
            charBox.style.backgroundColor = 'var(--invalid)';
            charBox.style.color = 'white';
          }
          
          break;
        }
        
        // Highlight the transition edge
        const edgeId = `${current}${next}${ch}`;
        cy.$(`#${current}`).removeClass('highlighted-node');
        cy.$(`#${edgeId}`).addClass('highlighted-edge');
        
        await new Promise(r => setTimeout(r, 400));
        
        // Mark as processed
        if (charBox) {
          charBox.classList.remove('current');
          charBox.classList.add('processed');
        }
        
        // Move to next state
        current = next;
        cy.$(`#${current}`).addClass('highlighted-node');
        
        // Update initial state box to show current state
        initialStateBox.textContent = current;
      }
      
      const isAccepted = valid && acceptingStates.includes(current);
      
      // Update final state appearance based on acceptance
      initialStateBox.style.backgroundColor = isAccepted ? 'var(--valid)' : 'var(--invalid)';
      
      // Scroll back to the beginning to show the final state
      if (input.length > 0) {
        setTimeout(() => {
          initialStateBox.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
        }, 500);
      }
      
      resultDisplay.textContent = isAccepted 
        ? "✅ Valid: String accepted by DFA" 
        : "❌ Invalid: String rejected by DFA";
      resultDisplay.className = isAccepted ? "valid" : "invalid";
    }

    simulateBtn.addEventListener('click', () => {
      const input = inputField.value.trim();
      if (!input) {
        resultDisplay.textContent = "⚠️ Please enter an input string";
        resultDisplay.className = "warn";
        // Clear previous animation
        inputAnimation.innerHTML = '';
        // Reset graph highlights
        cy.nodes().removeClass('highlighted-node');
        cy.edges().removeClass('highlighted-edge');
        cy.$('#q0').addClass('highlighted-node');
        return;
      }
      animateString(input);
    });

    // Improved Light/Dark toggle
    const toggleBtn = document.getElementById('mode-toggle');
    const toggleIcon = toggleBtn.querySelector('i');
    
    toggleBtn.addEventListener('click', () => {
      const body = document.body;
      const isDark = body.getAttribute('data-theme') === 'dark';
      body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      toggleIcon.className = isDark ? 'fas fa-moon' : 'fas fa-sun';
    });
    
    // Enable pressing Enter to simulate
    inputField.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        simulateBtn.click();
      }
    });
  </script>
</body>
</html>